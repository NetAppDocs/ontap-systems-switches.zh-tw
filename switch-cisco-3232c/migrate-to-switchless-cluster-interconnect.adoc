---
permalink: switch-cisco-3232c/migrate-to-switchless-cluster-interconnect.html 
sidebar: sidebar 
keywords: migrate, switchless cluster interconnect, cisco nexus switch 3232C 
summary: 對於ONTAP 9.3 及更高版本，您可以將叢集從具有交換叢集網路的叢集遷移到兩個節點直接連接的叢集。 
---
= 使用無交換器連接取代Cisco Nexus 3232C 叢集交換機
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
對於ONTAP 9.3 及更高版本，您可以將叢集從具有交換叢集網路的叢集遷移到兩個節點直接連接的叢集。



== 審查要求

.指南
請查閱以下準則：

* 遷移到雙節點無交換器叢集配置是一個非中斷性操作。大多數系統在每個節點上都有兩個專用群集互連端口，但對於每個節點上具有更多專用群集互連端口（例如四個、六個或八個）的系統，您也可以使用此過程。
* 無交換器群集互連功能不能用於兩個以上的節點。
* 如果您有一個使用集群互連交換器的現有雙節點集群，並且運行的是ONTAP 9.3 或更高版本，則可以將交換器替換為節點之間的直接、背靠背連接。


.開始之前
請確保您擁有以下物品：

* 一個健康的集群，由兩個節點透過集群交換機連接而成。節點必須運行相同的ONTAP版本。
* 每個節點都具有所需數量的專用叢集端口，這些端口提供冗餘的叢集互連連接，以支援您的系統配置。例如，對於每個節點上有兩個專用叢集互連連接埠的系統，有兩個冗餘連接埠。




== 遷移交換機

.關於此任務
以下步驟將移除雙節點叢集中的叢集交換機，並將每個與交換器的連線替換為與夥伴節點的直接連線。

image::../media/tnsc_clusterswitches_and_direct_connections.PNG[集群交換器被直接連接取代]

.關於範例
以下過程中的範例顯示了使用「e0a」和「e0b」作為叢集連接埠的節點。您的節點可能使用不同的叢集端口，因為不同系統的叢集端口可能不同。



=== 步驟 1：準備遷移

. 將權限級別變更為高級，輸入 `y`當系統提示繼續：
+
`set -privilege advanced`

+
進階提示 `*>`出現。

. ONTAP 9.3 及更高版本支援自動偵測無交換器集群，此功能預設為啟用。
+
您可以透過執行進階權限命令來驗證是否已啟用無交換器叢集偵測：

+
`network options detect-switchless-cluster show`

+
.顯示範例
[%collapsible]
====
以下範例輸出顯示該選項是否已啟用。

[listing]
----
cluster::*> network options detect-switchless-cluster show
   (network options detect-switchless-cluster show)
Enable Switchless Cluster Detection: true
----
====
+
如果“啟用無交換器叢集偵測” `false`請聯絡NetApp支援。

. 如果此叢集上啟用了AutoSupport ，則透過呼叫AutoSupport訊息來抑制自動建立案例：
+
`system node autosupport invoke -node * -type all -message MAINT=<number_of_hours>h`

+
在哪裡 `h`是維護窗口的持續時間，以小時為單位。該訊息通知技術支援人員此維護任務，以便他們在維護窗口期間禁止自動建立案例。

+
在以下範例中，該指令會抑制自動建立案例兩小時：

+
.顯示範例
[%collapsible]
====
[listing]
----
cluster::*> system node autosupport invoke -node * -type all -message MAINT=2h
----
====




=== 步驟二：設定埠和線纜

. 將每台交換器上的群集連接埠分成幾組，使第 1 組的群集連接埠連接到群集交換器 1，第 2 組的群集連接埠連接到群集交換器 2。這些組別在後續手術過程中是需要的。
. 識別叢集連接埠並驗證鏈路狀態和運行狀況：
+
`network port show -ipspace Cluster`

+
在下列範例中，對於叢集連接埠為“e0a”和“e0b”的節點，一組被標識為“node1:e0a”和“node2:e0a”，另一組被標識為“node1:e0b”和“node2:e0b”。您的節點可能正在使用不同的叢集端口，因為不同系統的叢集連接埠可能不同。

+
image::../media/tnsc_clusterswitch_connections.PNG[叢集交換器連接節點1和節點2]

+
確認連接埠的值是否為 `up`對於「連結」列，其值為 `healthy`在「健康狀況」一欄。

+
.顯示範例
[%collapsible]
====
[listing]
----
cluster::> network port show -ipspace Cluster
Node: node1
                                                                 Ignore
                                             Speed(Mbps) Health  Health
Port  IPspace   Broadcast Domain Link  MTU   Admin/Oper	 Status  Status
----- --------- ---------------- ----- ----- ----------- ------- -------
e0a   Cluster   Cluster          up    9000  auto/10000  healthy false
e0b   Cluster   Cluster          up    9000  auto/10000  healthy false

Node: node2
                                                                 Ignore
                                             Speed(Mbps) Health  Health
Port  IPspace   Broadcast Domain Link  MTU   Admin/Oper	 Status  Status
----- --------- ---------------- ----- ----- ----------- ------- -------
e0a   Cluster   Cluster          up    9000  auto/10000  healthy false
e0b   Cluster   Cluster          up    9000  auto/10000  healthy false
4 entries were displayed.
----
====
. 確認叢集中的所有 LIF 都位於其主連接埠上。
+
確認“is-home”列是否為空 `true`對於每個集群 LIF：

+
`network interface show -vserver Cluster -fields is-home`

+
.顯示範例
[%collapsible]
====
[listing]
----
cluster::*> net int show -vserver Cluster -fields is-home
(network interface show)
vserver  lif          is-home
-------- ------------ --------
Cluster  node1_clus1  true
Cluster  node1_clus2  true
Cluster  node2_clus1  true
Cluster  node2_clus2  true
4 entries were displayed.
----
====
+
如果叢集中存在未部署在其原始連接埠上的 LIF，請將這些 LIF 還原至其原始連接埠：

+
`network interface revert -vserver Cluster -lif *`

. 停用叢集 LIF 的自動回滾功能：
+
`network interface modify -vserver Cluster -lif * -auto-revert false`

. 確認上一步中列出的所有連接埠都已連接到網路交換器：
+
`network device-discovery show -port _cluster_port_`

+
「已發現設備」列應顯示連接埠所連接的群集交換器的名稱。

+
.顯示範例
[%collapsible]
====
以下範例表示叢集連接埠「e0a」和「e0b」已正確連接至叢集交換器「cs1」和「cs2」。

[listing]
----
cluster::> network device-discovery show -port e0a|e0b
  (network device-discovery show)
Node/     Local  Discovered
Protocol  Port   Device (LLDP: ChassisID)  Interface  Platform
--------- ------ ------------------------- ---------- ----------
node1/cdp
          e0a    cs1                       0/11       BES-53248
          e0b    cs2                       0/12       BES-53248
node2/cdp
          e0a    cs1                       0/9        BES-53248
          e0b    cs2                       0/9        BES-53248
4 entries were displayed.
----
====
. 驗證遠端集群介面的連接性：


[role="tabbed-block"]
====
.ONTAP 9.9.1 及更高版本
--
你可以使用 `network interface check cluster-connectivity`執行命令以啟動叢集連接性檢查，然後顯示詳細資訊：

`network interface check cluster-connectivity start`和 `network interface check cluster-connectivity show`

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity start*
----
*注意：*運行程式前請等待幾秒鐘 `show`顯示詳細資訊的命令。

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity show*
                                  Source           Destination      Packet
Node   Date                       LIF              LIF              Loss
------ -------------------------- ---------------- ---------------- -----------
node1
       3/5/2022 19:21:18 -06:00   node1_clus2      node2-clus1      none
       3/5/2022 19:21:20 -06:00   node1_clus2      node2_clus2      none
node2
       3/5/2022 19:21:18 -06:00   node2_clus2      node1_clus1      none
       3/5/2022 19:21:20 -06:00   node2_clus2      node1_clus2      none
----
--
.所有ONTAP版本
--
對於所有ONTAP版本，您也可以使用 `cluster ping-cluster -node <name>`檢查連接性的命令：

`cluster ping-cluster -node <name>`

[listing, subs="+quotes"]
----
cluster1::*> *cluster ping-cluster -node local*
Host is node2
Getting addresses from network interface table...
Cluster node1_clus1 169.254.209.69 node1 e0a
Cluster node1_clus2 169.254.49.125 node1 e0b
Cluster node2_clus1 169.254.47.194 node2 e0a
Cluster node2_clus2 169.254.19.183 node2 e0b
Local = 169.254.47.194 169.254.19.183
Remote = 169.254.209.69 169.254.49.125
Cluster Vserver Id = 4294967293
Ping status:

Basic connectivity succeeds on 4 path(s)
Basic connectivity fails on 0 path(s)

Detected 9000 byte MTU on 4 path(s):
Local 169.254.47.194 to Remote 169.254.209.69
Local 169.254.47.194 to Remote 169.254.49.125
Local 169.254.19.183 to Remote 169.254.209.69
Local 169.254.19.183 to Remote 169.254.49.125
Larger than PMTU communication succeeds on 4 path(s)
RPC status:
2 paths up, 0 paths down (tcp check)
2 paths up, 0 paths down (udp check)
----
--
====
. [[步驟7]] 驗證叢集是否運作正常：
+
`cluster ring show`

+
所有單元必須要麼是主單元，要麼是從單元。

. 為第 1 組連接埠設定無交換器配置。
+

IMPORTANT: 為避免潛在的網路問題，您必須斷開 group1 中的端口，並儘快將它們重新連接起來，例如，*在 20 秒內*。

+
.. 同時斷開第 1 組連接埠上的所有電纜。
+
在下列範例中，電纜從每個節點的連接埠「e0a」斷開，叢集流量繼續透過交換器和每個節點的連接埠「e0b」傳輸：

+
image::../media/tnsc_clusterswitch1_disconnected.PNG[集群交換器1已斷開連接]

.. 將第 1 組中的連接埠背對背連接起來。
+
在下列範例中，節點 1 上的「e0a」連接到節點 2 上的「e0a」：

+
image::../media/tnsc_ports_e0a_direct_connection.PNG[連接埠“e0a”之間的直接連接]



. 無交換器集群網路選項從 `false`到 `true`。這可能需要長達 45 秒。確認無開關選項已設定為 `true`：
+
`network options switchless-cluster show`

+
以下範例表示已啟用無交換器叢集：

+
[listing]
----
cluster::*> network options switchless-cluster show
Enable Switchless Cluster: true
----
. 驗證遠端集群介面的連接性：


[role="tabbed-block"]
====
.ONTAP 9.9.1 及更高版本
--
你可以使用 `network interface check cluster-connectivity`執行命令以啟動叢集連接性檢查，然後顯示詳細資訊：

`network interface check cluster-connectivity start`和 `network interface check cluster-connectivity show`

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity start*
----
*注意：*運行程式前請等待幾秒鐘 `show`顯示詳細資訊的命令。

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity show*
                                  Source           Destination      Packet
Node   Date                       LIF              LIF              Loss
------ -------------------------- ---------------- ---------------- -----------
node1
       3/5/2022 19:21:18 -06:00   node1_clus2      node2-clus1      none
       3/5/2022 19:21:20 -06:00   node1_clus2      node2_clus2      none
node2
       3/5/2022 19:21:18 -06:00   node2_clus2      node1_clus1      none
       3/5/2022 19:21:20 -06:00   node2_clus2      node1_clus2      none
----
--
.所有ONTAP版本
--
對於所有ONTAP版本，您也可以使用 `cluster ping-cluster -node <name>`檢查連接性的命令：

`cluster ping-cluster -node <name>`

[listing, subs="+quotes"]
----
cluster1::*> *cluster ping-cluster -node local*
Host is node2
Getting addresses from network interface table...
Cluster node1_clus1 169.254.209.69 node1 e0a
Cluster node1_clus2 169.254.49.125 node1 e0b
Cluster node2_clus1 169.254.47.194 node2 e0a
Cluster node2_clus2 169.254.19.183 node2 e0b
Local = 169.254.47.194 169.254.19.183
Remote = 169.254.209.69 169.254.49.125
Cluster Vserver Id = 4294967293
Ping status:

Basic connectivity succeeds on 4 path(s)
Basic connectivity fails on 0 path(s)

Detected 9000 byte MTU on 4 path(s):
Local 169.254.47.194 to Remote 169.254.209.69
Local 169.254.47.194 to Remote 169.254.49.125
Local 169.254.19.183 to Remote 169.254.209.69
Local 169.254.19.183 to Remote 169.254.49.125
Larger than PMTU communication succeeds on 4 path(s)
RPC status:
2 paths up, 0 paths down (tcp check)
2 paths up, 0 paths down (udp check)
----
--
====

IMPORTANT: 在進行下一步之前，您必須等待至少兩分鐘，以確認第 1 組上的連續連線是否正常運作。

. [[step11]] 為第 2 組連接埠設定無交換器配置。
+

IMPORTANT: 為避免潛在的網路問題，您必須斷開 group2 中的端口，並儘快將它們重新連接起來，例如，*在 20 秒內*。

+
.. 同時斷開第 2 組連接埠上的所有電纜。
+
在以下範例中，每個節點上的連接埠「e0b」的電纜已斷開，叢集流量繼續透過「e0a」連接埠之間的直接連接進行傳輸：

+
image::../media/tnsc_clusterswitch2_disconnected.PNG[集群交換器2已斷開連接]

.. 將第 2 組中的連接埠背對背連接起來。
+
在下列範例中，節點 1 上的“e0a”連接到節點 2 上的“e0a”，節點 1 上的“e0b”連接到節點 2 上的“e0b”：

+
image::../media/tnsc_node1_and_node2_direct_connection.PNG[節點1和節點2上的連接埠之間直接連接]







=== 步驟 3：驗證配置

. 請確認兩個節點上的連接埠連接正確：
+
`network device-discovery show -port _cluster_port_`

+
.顯示範例
[%collapsible]
====
以下範例表示叢集連接埠「e0a」和「e0b」已正確連接到叢集夥伴上的對應連接埠：

[listing]
----
cluster::> net device-discovery show -port e0a|e0b
  (network device-discovery show)
Node/      Local  Discovered
Protocol   Port   Device (LLDP: ChassisID)  Interface  Platform
---------- ------ ------------------------- ---------- ----------
node1/cdp
           e0a    node2                     e0a        AFF-A300
           e0b    node2                     e0b        AFF-A300
node1/lldp
           e0a    node2 (00:a0:98:da:16:44) e0a        -
           e0b    node2 (00:a0:98:da:16:44) e0b        -
node2/cdp
           e0a    node1                     e0a        AFF-A300
           e0b    node1                     e0b        AFF-A300
node2/lldp
           e0a    node1 (00:a0:98:da:87:49) e0a        -
           e0b    node1 (00:a0:98:da:87:49) e0b        -
8 entries were displayed.
----
====
. 重新啟用叢集 LIF 的自動回滾功能：
+
`network interface modify -vserver Cluster -lif * -auto-revert true`

. 確認所有 LIF 設備都已到位。這可能需要幾秒鐘。
+
`network interface show -vserver Cluster -lif _lif_name_`

+
.顯示範例
[%collapsible]
====
如果「是否在家」列為真，則 LIF 已被還原。 `true`如圖所示 `node1_clus2`和 `node2_clus2`在以下範例中：

[listing]
----
cluster::> network interface show -vserver Cluster -fields curr-port,is-home
vserver  lif           curr-port is-home
-------- ------------- --------- -------
Cluster  node1_clus1   e0a       true
Cluster  node1_clus2   e0b       true
Cluster  node2_clus1   e0a       true
Cluster  node2_clus2   e0b       true
4 entries were displayed.
----
====
+
如果任何叢集 LIFS 尚未恢復到其主端口，請從本機節點手動將其還原：

+
`network interface revert -vserver Cluster -lif _lif_name_`

. 從任一節點的系統控制台檢查節點的叢集狀態：
+
`cluster show`

+
.顯示範例
[%collapsible]
====
以下範例顯示兩個節點上的 ε 均為 `false`：

[listing]
----
Node  Health  Eligibility Epsilon
----- ------- ----------- --------
node1 true    true        false
node2 true    true        false
2 entries were displayed.
----
====
. 驗證遠端集群介面的連接性：


[role="tabbed-block"]
====
.ONTAP 9.9.1 及更高版本
--
你可以使用 `network interface check cluster-connectivity`執行命令以啟動叢集連接性檢查，然後顯示詳細資訊：

`network interface check cluster-connectivity start`和 `network interface check cluster-connectivity show`

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity start*
----
*注意：*運行程式前請等待幾秒鐘 `show`顯示詳細資訊的命令。

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity show*
                                  Source           Destination      Packet
Node   Date                       LIF              LIF              Loss
------ -------------------------- ---------------- ---------------- -----------
node1
       3/5/2022 19:21:18 -06:00   node1_clus2      node2-clus1      none
       3/5/2022 19:21:20 -06:00   node1_clus2      node2_clus2      none
node2
       3/5/2022 19:21:18 -06:00   node2_clus2      node1_clus1      none
       3/5/2022 19:21:20 -06:00   node2_clus2      node1_clus2      none
----
--
.所有ONTAP版本
--
對於所有ONTAP版本，您也可以使用 `cluster ping-cluster -node <name>`檢查連接性的命令：

`cluster ping-cluster -node <name>`

[listing, subs="+quotes"]
----
cluster1::*> *cluster ping-cluster -node local*
Host is node2
Getting addresses from network interface table...
Cluster node1_clus1 169.254.209.69 node1 e0a
Cluster node1_clus2 169.254.49.125 node1 e0b
Cluster node2_clus1 169.254.47.194 node2 e0a
Cluster node2_clus2 169.254.19.183 node2 e0b
Local = 169.254.47.194 169.254.19.183
Remote = 169.254.209.69 169.254.49.125
Cluster Vserver Id = 4294967293
Ping status:

Basic connectivity succeeds on 4 path(s)
Basic connectivity fails on 0 path(s)

Detected 9000 byte MTU on 4 path(s):
Local 169.254.47.194 to Remote 169.254.209.69
Local 169.254.47.194 to Remote 169.254.49.125
Local 169.254.19.183 to Remote 169.254.209.69
Local 169.254.19.183 to Remote 169.254.49.125
Larger than PMTU communication succeeds on 4 path(s)
RPC status:
2 paths up, 0 paths down (tcp check)
2 paths up, 0 paths down (udp check)
----
--
====
. [[步驟6]] 如果您已停用自動建立案例功能，請透過呼叫AutoSupport訊息重新啟用此功能：
+
`system node autosupport invoke -node * -type all -message MAINT=END`

+
有關詳細信息，請參閱 link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/ONTAP_OS/How_to_suppress_automatic_case_creation_during_scheduled_maintenance_windows_-_ONTAP_9["NetApp知識庫文章 1010449：如何在計畫維護窗口期間禁止自動建立案例"^]。

. 將權限等級改回管理員：
+
`set -privilege admin`


